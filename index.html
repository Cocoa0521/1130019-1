<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜æ†¶é…å°éŠæˆ²</title>
    <style>
        /* --- æ•´é«”é é¢æ¨£å¼ --- */
        :root {
            --card-size: clamp(60px, 18vw, 100px); /* å¡ç‰‡å¤§å°ï¼Œå¯é©æ‡‰ä¸åŒè¢å¹• */
            --grid-gap: 15px;
            --primary-color: #3a9bff; /* èª¿æ•´ç‚ºäº®è—è‰²ä»¥å¢åŠ å°æ¯”åº¦ */
            --background-color: #121212; /* å°‡èƒŒæ™¯æ”¹ç‚ºé»‘è‰² */
            --card-color: #1e1e1e; /* å°‡å®¹å™¨æ”¹ç‚ºæ·±ç°è‰² */
            --card-matched-color: #2e4f34; /* é…å°æˆåŠŸçš„æ·±ç¶ è‰² */
            --font-color: #e0e0e0; /* å°‡å­—é«”æ”¹ç‚ºæ·ºç°è‰² */
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--background-color);
            margin: 0;
            box-sizing: border-box;
        }

        /* --- éŠæˆ²ä¸»å®¹å™¨ --- */
        .game-container {
            text-align: center;
            background-color: var(--card-color);
            padding: clamp(15px, 5vw, 30px);
            width: 100vw; /* è¨­å®šå¯¬åº¦ç‚º100%è¦–çª—å¯¬åº¦ */
            min-height: 100vh; /* è¨­å®šæœ€å°é«˜åº¦ç‚º100%è¦–çª—é«˜åº¦ */
            display: flex; /* ä½¿ç”¨ Flexbox ä¾†ç½®ä¸­å…§å®¹ */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒå½±éŸ¿æ•´é«”å°ºå¯¸ */
        }

        h1 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 20px;
            font-size: clamp(1.8rem, 6vw, 2.5rem);
        }

        /* --- è¨­å®šå€å¡Š --- */
        .settings {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .settings div {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings label {
            color: var(--font-color);
            font-weight: 500;
        }

        .settings select {
            padding: 5px 8px;
            border-radius: 6px;
            border: 1px solid #444;
            background-color: #333;
            color: var(--font-color);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .settings select:hover {
            background-color: #444;
        }

        .settings select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* --- éŠæˆ²è³‡è¨Š (æ­¥æ•¸, æ™‚é–“) --- */
        .stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
            font-size: clamp(1rem, 4vw, 1.2rem);
            color: var(--font-color);
            font-weight: 500;
        }

        /* --- éŠæˆ²é¢æ¿ --- */
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--grid-gap);
            perspective: 1000px;
            margin: 0 auto 20px;
            width: 100%;
            max-width: 800px;
        }

        /* --- å¡ç‰Œæ¨£å¼ --- */
        .card {
            width: var(--card-size);
            height: var(--card-size);
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            aspect-ratio: 1 / 1;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(2rem, 10vw, 3.5rem);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .card-front {
            background: linear-gradient(135deg, #89cff0, #4682b4);
            color: white;
        }

        .card-back {
            background-color: var(--card-color);
            transform: rotateY(180deg);
        }
        
        .card.matched .card-back {
            background-color: var(--card-matched-color);
            box-shadow: 0 0 10px #28a745;
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0% { transform: rotateY(180deg) scale(1); }
            50% { transform: rotateY(180deg) scale(1.1); }
            100% { transform: rotateY(180deg) scale(1); }
        }

        /* --- æŒ‰éˆ•å€å¡Š --- */
        .actions {
            display: flex;
            gap: 15px;
        }

        /* --- æŒ‰éˆ•æ¨£å¼ --- */
        .btn {
            padding: 12px 25px;
            font-size: clamp(1rem, 4vw, 1.1rem);
            color: white;
            background-color: var(--primary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn.secondary {
            background-color: #6c757d;
        }
        .btn.secondary:hover {
             background-color: #5a6268;
        }


        /* --- å½ˆå‡ºè¦–çª— --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2a2a2a;
            margin: auto;
            padding: 20px 30px;
            border: 1px solid #444;
            width: 90%;
            max-width: 500px;
            border-radius: var(--border-radius);
            text-align: center;
            animation: slide-down 0.5s ease-out;
        }
        
        @keyframes slide-down {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content h2 { color: var(--primary-color); }
        .modal-content p { color: var(--font-color); }
        
        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .modal-content input {
            width: 80%;
            padding: 10px;
            margin: 15px 0;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: var(--font-color);
            font-size: 1rem;
        }

        /* æ’è¡Œæ¦œè¡¨æ ¼ */
        #leaderboard-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        #leaderboard-table th, #leaderboard-table td {
            padding: 10px;
            border-bottom: 1px solid #444;
            color: var(--font-color);
        }
        #leaderboard-table th {
            color: var(--primary-color);
        }
        #leaderboard-table tr:last-child td {
            border-bottom: none;
        }

    </style>
</head>
<body>

    <div class="game-container">
        <h1>è¨˜æ†¶é…å°éŠæˆ²</h1>
        <div class="settings">
            <div>
                <label for="difficulty-select">é›£åº¦:</label>
                <select id="difficulty-select">
                    <option value="easy">ç°¡å–® (4x2)</option>
                    <option value="medium" selected>ä¸­ç­‰ (4x4)</option>
                    <option value="hard">å›°é›£ (6x4)</option>
                </select>
            </div>
            <div>
                <label for="theme-select">ä¸»é¡Œ:</label>
                <select id="theme-select">
                    <option value="animals" selected>å‹•ç‰©</option>
                    <option value="fruits">æ°´æœ</option>
                    <option value="food">é£Ÿç‰©</option>
                    <option value="vehicles">äº¤é€šå·¥å…·</option>
                </select>
            </div>
            <div>
                <label for="timer-select">è¨ˆæ™‚:</label>
                <select id="timer-select">
                    <option value="unlimited" selected>ç„¡é™</option>
                    <option value="30">30ç§’</option>
                    <option value="60">60ç§’</option>
                    <option value="90">90ç§’</option>
                </select>
            </div>
        </div>
        <div class="stats">
            <div id="moves-count">æ­¥æ•¸: 0</div>
            <div id="timer">æ™‚é–“: 0s</div>
        </div>
        <div class="game-board" id="game-board"></div>
        <div class="actions">
            <button class="btn" id="restart-btn">é–‹å§‹éŠæˆ²</button>
            <button class="btn secondary" id="leaderboard-btn">æ’è¡Œæ¦œ</button>
        </div>
    </div>

    <!-- è¼¸å…¥åç¨± Modal -->
    <div id="name-modal" class="modal">
        <div class="modal-content">
            <h2>æ­å–œç²å‹ï¼</h2>
            <p id="final-score-p"></p>
            <p>è«‹è¼¸å…¥æ‚¨çš„å¤§åä»¥è¨˜éŒ„åˆ†æ•¸ï¼š</p>
            <input type="text" id="player-name-input" placeholder="ç©å®¶åç¨±" maxlength="10">
            <button class="btn" id="submit-score-btn">æäº¤åˆ†æ•¸</button>
        </div>
    </div>
    
    <!-- æ’è¡Œæ¦œ Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <h2>æ’è¡Œæ¦œ (Top 10)</h2>
            <table id="leaderboard-table">
                <thead>
                    <tr><th>æ’å</th><th>åç¨±</th><th>åˆ†æ•¸</th><th>é›£åº¦</th></tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
            <button class="btn" id="close-leaderboard-btn" style="margin-top: 20px;">é—œé–‰</button>
        </div>
    </div>

    <!-- éŠæˆ²å¤±æ•— Modal -->
    <div id="lose-modal" class="modal">
        <div class="modal-content">
            <h2>æ™‚é–“åˆ°ï¼</h2>
            <p>åˆ¥ç°å¿ƒï¼Œå†è©¦ä¸€æ¬¡å§ï¼</p>
            <button class="btn" id="modal-try-again-btn">å†è©¦ä¸€æ¬¡</button>
        </div>
    </div>


    <script>
        // --- DOM å…ƒç´ ç²å– ---
        const gameBoard = document.getElementById('game-board');
        const movesCountSpan = document.getElementById('moves-count');
        const timerSpan = document.getElementById('timer');
        const restartBtn = document.getElementById('restart-btn');
        const difficultySelect = document.getElementById('difficulty-select');
        const themeSelect = document.getElementById('theme-select');
        const timerSelect = document.getElementById('timer-select');

        // Modals
        const nameModal = document.getElementById('name-modal');
        const finalScoreP = document.getElementById('final-score-p');
        const playerNameInput = document.getElementById('player-name-input');
        const submitScoreBtn = document.getElementById('submit-score-btn');
        const leaderboardModal = document.getElementById('leaderboard-modal');
        const leaderboardBtn = document.getElementById('leaderboard-btn');
        const closeLeaderboardBtn = document.getElementById('close-leaderboard-btn');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const loseModal = document.getElementById('lose-modal');
        const modalTryAgainBtn = document.getElementById('modal-try-again-btn');
        
        const LEADERBOARD_KEY = 'memoryGameLeaderboard';

        // --- éŠæˆ²è¨­å®š ---
        const themes = {
            animals: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®'],
            fruits: ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸ‰', 'ğŸ“', 'ğŸ‘', 'ğŸ', 'ğŸ¥', 'ğŸ¥­', 'ğŸ¥¥', 'ğŸ’', 'ğŸ‹'],
            food: ['ğŸ•', 'ğŸ”', 'ğŸŸ', 'ğŸŒ­', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸ°', 'ğŸ£', 'ğŸŒ®', 'ğŸ¦', 'ğŸ¥'],
            vehicles: ['ğŸš—', 'ğŸš•', 'ğŸšŒ', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸšš', 'ğŸšœ', 'ğŸš²', 'ğŸ›µ', 'âœˆï¸', 'ğŸš€']
        };

        const difficultySettings = {
            easy: { pairs: 4, cols: 4, score: 1000 },
            medium: { pairs: 8, cols: 4, score: 2500 },
            hard: { pairs: 12, cols: 6, score: 5000 }
        };

        // --- éŠæˆ²ç‹€æ…‹è®Šæ•¸ ---
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let lockBoard = true;
        let gameActive = false;
        let timer;
        let seconds = 0;
        let isCountdown = false;
        let finalScore = 0;

        // --- éŠæˆ²ä¸»è¦åŠŸèƒ½ ---

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function prepareGame() {
            gameActive = false;
            lockBoard = true;
            restartBtn.textContent = 'é–‹å§‹éŠæˆ²';
            [difficultySelect, themeSelect, timerSelect].forEach(sel => sel.disabled = false);
            clearInterval(timer);

            const difficulty = difficultySelect.value;
            const theme = themeSelect.value;
            const currentDifficulty = difficultySettings[difficulty];
            const currentThemeEmojis = themes[theme].slice(0, currentDifficulty.pairs);
            cards = [...currentThemeEmojis, ...currentThemeEmojis];
            
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            movesCountSpan.textContent = `æ­¥æ•¸: 0`;

            const selectedTime = timerSelect.value;
            if (selectedTime === 'unlimited') {
                isCountdown = false;
                seconds = 0;
                timerSpan.textContent = 'æ™‚é–“: 0s';
            } else {
                isCountdown = true;
                seconds = parseInt(selectedTime, 10);
                timerSpan.textContent = `æ™‚é–“: ${seconds}s`;
            }

            [nameModal, leaderboardModal, loseModal].forEach(modal => modal.style.display = 'none');
            shuffle(cards);
            createBoard();
        }

        function activateGame() {
            if (gameActive) return;
            gameActive = true;
            lockBoard = false;
            [difficultySelect, themeSelect, timerSelect].forEach(sel => sel.disabled = true);
            timer = setInterval(updateTimer, 1000);
            restartBtn.textContent = 'é‡æ–°é–‹å§‹';
        }

        function createBoard() {
            const difficulty = difficultySelect.value;
            const currentDifficulty = difficultySettings[difficulty];
            gameBoard.style.gridTemplateColumns = `repeat(${currentDifficulty.cols}, 1fr)`;
            gameBoard.innerHTML = '';
            cards.forEach(emoji => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('card');
                cardElement.dataset.emoji = emoji;
                cardElement.innerHTML = `
                    <div class="card-face card-front">?</div>
                    <div class="card-face card-back">${emoji}</div>`;
                cardElement.addEventListener('click', handleCardClick);
                gameBoard.appendChild(cardElement);
            });
        }
        
        function handleCardClick(event) {
            const clickedCard = event.currentTarget;
            if (lockBoard || clickedCard.classList.contains('flipped') || flippedCards.length >= 2) return;
            clickedCard.classList.add('flipped');
            flippedCards.push(clickedCard);
            if (flippedCards.length === 2) {
                incrementMoves();
                checkForMatch();
            }
        }
        
        function checkForMatch() {
            lockBoard = true;
            const [card1, card2] = flippedCards;
            if (card1.dataset.emoji === card2.dataset.emoji) {
                setTimeout(() => {
                    card1.classList.add('matched');
                    card2.classList.add('matched');
                    matchedPairs++;
                    resetTurn();
                    const currentDifficulty = difficultySettings[difficultySelect.value];
                    if (matchedPairs === currentDifficulty.pairs) endGame();
                }, 500);
            } else {
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    resetTurn();
                }, 1000);
            }
        }

        function resetTurn() {
            flippedCards = [];
            lockBoard = false;
        }

        function incrementMoves() {
            moves++;
            movesCountSpan.textContent = `æ­¥æ•¸: ${moves}`;
        }

        function updateTimer() {
            if (isCountdown) {
                seconds--;
                if (seconds <= 0) {
                    timerSpan.textContent = 'æ™‚é–“: 0s';
                    gameOver();
                    return;
                }
            } else {
                seconds++;
            }
            timerSpan.textContent = `æ™‚é–“: ${seconds}s`;
        }
        
        function calculateScore() {
            const difficulty = difficultySelect.value;
            const baseScore = difficultySettings[difficulty].score;
            let score = 0;
            if (isCountdown) {
                // å€’æ•¸æ¨¡å¼ï¼šå‰©é¤˜æ™‚é–“æœ‰åŠ æˆ
                score = baseScore + (seconds * 20) - (moves * 10);
            } else {
                // ç„¡é™æ¨¡å¼ï¼šæ™‚é–“å’Œæ­¥æ•¸éƒ½æ˜¯æ‰£åˆ†é …
                score = baseScore - (seconds * 5) - (moves * 15);
            }
            return Math.max(0, score); // åˆ†æ•¸ä¸èƒ½æ˜¯è² æ•¸
        }

        function endGame() {
            clearInterval(timer);
            gameActive = false;
            finalScore = calculateScore();
            finalScoreP.textContent = `æ‚¨çš„æœ€çµ‚åˆ†æ•¸: ${finalScore}`;
            nameModal.style.display = 'flex';
        }

        function gameOver() {
            clearInterval(timer);
            lockBoard = true;
            gameActive = false;
            loseModal.style.display = 'flex';
        }
        
        function getLeaderboard() {
            return JSON.parse(localStorage.getItem(LEADERBOARD_KEY)) || [];
        }

        function saveToLeaderboard(entry) {
            const leaderboard = getLeaderboard();
            leaderboard.push(entry);
            leaderboard.sort((a, b) => b.score - a.score); // åˆ†æ•¸ç”±é«˜åˆ°ä½æ’åº
            const top10 = leaderboard.slice(0, 10);
            localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(top10));
        }
        
        function displayLeaderboard() {
            const leaderboard = getLeaderboard();
            leaderboardBody.innerHTML = ''; // æ¸…ç©ºèˆŠçš„åˆ—è¡¨
            if(leaderboard.length === 0) {
                 leaderboardBody.innerHTML = `<tr><td colspan="4">ç›®å‰å°šç„¡ç´€éŒ„</td></tr>`;
            } else {
                leaderboard.forEach((entry, index) => {
                    const row = document.createElement('tr');
                    const difficultyMap = { easy: 'ç°¡å–®', medium: 'ä¸­ç­‰', hard: 'å›°é›£' };
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${entry.name}</td>
                        <td>${entry.score}</td>
                        <td>${difficultyMap[entry.difficulty]}</td>
                    `;
                    leaderboardBody.appendChild(row);
                });
            }
            leaderboardModal.style.display = 'flex';
        }

        // --- äº‹ä»¶ç›£è½ ---
        restartBtn.addEventListener('click', () => {
            if (!gameActive) activateGame();
            else prepareGame();
        });
        
        submitScoreBtn.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            if (name) {
                const entry = {
                    name: name,
                    score: finalScore,
                    difficulty: difficultySelect.value
                };
                saveToLeaderboard(entry);
                playerNameInput.value = '';
                nameModal.style.display = 'none';
                displayLeaderboard();
            } else {
                alert('è«‹è¼¸å…¥æ‚¨çš„åç¨±ï¼');
            }
        });

        leaderboardBtn.addEventListener('click', displayLeaderboard);
        closeLeaderboardBtn.addEventListener('click', () => {
            leaderboardModal.style.display = 'none';
            prepareGame(); // é—œé–‰æ’è¡Œæ¦œå¾Œé‡ç½®éŠæˆ²
        });
        modalTryAgainBtn.addEventListener('click', prepareGame);

        [difficultySelect, themeSelect, timerSelect].forEach(sel => sel.addEventListener('change', prepareGame));
        document.addEventListener('DOMContentLoaded', prepareGame);
    </script>
</body>
</html>

